# OpenOCD configuration for dual-JTAG daisy chain simulation

adapter driver remote_bitbang
remote_bitbang host localhost
remote_bitbang port 9823

# Define the TAPs
# Note: OpenOCD scans data from TDO to TDI. 
# The device closest to TDO shifts out its IDCODE first.
# Based on the error log, OpenOCD matches the first defined TAP with the first ID received (TDO side).
# So we define the TAPs in order from TDO to TDI.

# TAP 2 (Closest to TDO)
jtag newtap tap2 tap -irlen 4 -expected-id 0x20000001

# TAP 1 (Closest to TDI)
jtag newtap tap1 tap -irlen 4 -expected-id 0x10000001

# Initialize
init

# Scan the chain to verify
scan_chain

# Example test: Read IDCODEs again manually
irscan tap1.tap 1
drscan tap1.tap 32 0

irscan tap2.tap 1
drscan tap2.tap 32 0

# Example test: Blink LEDs
# TAP1 User Data (IR=0x2) -> Write 0xAA
irscan tap1.tap 2
drscan tap1.tap 8 0xAA

# TAP2 User Data (IR=0x2) -> Write 0x55
irscan tap2.tap 2
drscan tap2.tap 8 0x55

echo "Tests completed. Check simulator output for LED values."
